



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Nothing is impossible">
      
      
        <link rel="canonical" href="https://1007530194.github.io/Diary/学习/转载/example/a-web-crawer-with-a-asyncio-coroutines-2/">
      
      
        <meta name="author" content="NiuLiangtao">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.0">
    
    
      
        <title>A web crawer with a asyncio coroutines 2 - Blog of NiuLiangtao</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.78aab2dc.css">
      
    
    
      <script src="../../../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#coroutines" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://1007530194.github.io/Diary/" title="Blog of NiuLiangtao" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Blog of NiuLiangtao
              </span>
              <span class="md-header-nav__topic">
                A web crawer with a asyncio coroutines 2
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/1007530194/Diary" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      1007530194/Diary
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Blog of NiuLiangtao
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/1007530194/Diary" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      1007530194/Diary
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../ToDo/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Home
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Home
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../AboutMe/" title="About" class="md-nav__link">
      About
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../Nothing/" title="Nothing" class="md-nav__link">
      Nothing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../ToDo/" title="要做的" class="md-nav__link">
      要做的
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      书籍
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        书籍
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      机器学习实战
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        机器学习实战
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/00naive-bayes-discuss/" title="naive-bayes-discuss" class="md-nav__link">
      naive-bayes-discuss
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/01.机器学习基础/" title="1.机器学习基础" class="md-nav__link">
      1.机器学习基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/02.k-近邻算法/" title="2.k-近邻算法" class="md-nav__link">
      2.k-近邻算法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/03.决策树/" title="3.决策树" class="md-nav__link">
      3.决策树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/04.朴素贝叶斯/" title="4.朴素贝叶斯" class="md-nav__link">
      4.朴素贝叶斯
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/05.Logistic回归/" title="5.Logistic回归" class="md-nav__link">
      5.Logistic回归
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/06.0.支持向量机/" title="6.支持向量机" class="md-nav__link">
      6.支持向量机
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/06.1.支持向量机的几个通俗理解/" title="6.1.支持向量机的几个通俗理解" class="md-nav__link">
      6.1.支持向量机的几个通俗理解
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/07.集成方法-随机森林和AdaBoost/" title="7.集成方法-随机森林和AdaBoost" class="md-nav__link">
      7.集成方法-随机森林和AdaBoost
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/08.预测数值型数据-回归/" title="8.预测数值型数据：回归" class="md-nav__link">
      8.预测数值型数据：回归
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/09.树回归/" title="9.树回归" class="md-nav__link">
      9.树回归
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/10.k-means聚类/" title="10.k-means聚类" class="md-nav__link">
      10.k-means聚类
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/11.使用Apriori算法进行关联分析/" title="11.使用Apriori算法进行关联分析" class="md-nav__link">
      11.使用Apriori算法进行关联分析
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/12.使用FP-growth算法来高效发现频繁项集/" title="12.使用FP-growth算法来高效发现频繁项集" class="md-nav__link">
      12.使用FP-growth算法来高效发现频繁项集
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/13.利用PCA来简化数据/" title="13.利用PCA来简化数据" class="md-nav__link">
      13.利用PCA来简化数据
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/14.利用SVD简化数据/" title="14.利用SVD简化数据" class="md-nav__link">
      14.利用SVD简化数据
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/15.大数据与MapReduce/" title="15.大数据与MapReduce" class="md-nav__link">
      15.大数据与MapReduce
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/机器学习实战/16.推荐系统/" title="16.推荐系统" class="md-nav__link">
      16.推荐系统
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      深度学习
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        深度学习
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../书籍/深度学习/DeepLearning/" title="深度学习中文版" class="md-nav__link">
      深度学习中文版
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      学习
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        学习
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      tensorflow
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        tensorflow
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tensorflow/如何选择优化器 optimizer/" title="如何选择优化器 optimizer" class="md-nav__link">
      如何选择优化器 optimizer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      深度学习
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        深度学习
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../深度学习/主成分分析-2/" title="主成分分析 (2)" class="md-nav__link">
      主成分分析 (2)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../深度学习/主成分分析/" title="主成分分析" class="md-nav__link">
      主成分分析
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../深度学习/最小二乘法/" title="最小二乘法" class="md-nav__link">
      最小二乘法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../深度学习/矩阵分解/" title="矩阵分解" class="md-nav__link">
      矩阵分解
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../深度学习/矩阵求导/" title="矩阵求导" class="md-nav__link">
      矩阵求导
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4" checked>
    
    <label class="md-nav__link" for="nav-4-4">
      转载
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        转载
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4-1" type="checkbox" id="nav-4-4-1">
    
    <label class="md-nav__link" for="nav-4-4-1">
      cs231n-ch
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-4-1">
        cs231n-ch
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-assignment2_google_cloud/" title="Google Cloud Tutorial Part 2 (with GPUs)" class="md-nav__link">
      Google Cloud Tutorial Part 2 (with GPUs)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-aws-tutorial/" title="aws-tutorial" class="md-nav__link">
      aws-tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-classification/" title="classification" class="md-nav__link">
      classification
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-convnet-tips/" title="convnet-tips" class="md-nav__link">
      convnet-tips
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-convolutional-networks/" title="convolutional-networks" class="md-nav__link">
      convolutional-networks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-google_cloud_tutorial/" title="Google Cloud Tutorial gce-tutorial" class="md-nav__link">
      Google Cloud Tutorial gce-tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-ipython-tutorial/" title="IPython Tutorial ipython-tutorial" class="md-nav__link">
      IPython Tutorial ipython-tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-linear-classify/" title="线性分类" class="md-nav__link">
      线性分类
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-neural-networks-1/" title="neural-networks-1" class="md-nav__link">
      neural-networks-1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-neural-networks-2/" title="neural-networks-2" class="md-nav__link">
      neural-networks-2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-neural-networks-3/" title="neural-networks-3" class="md-nav__link">
      neural-networks-3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-neural-networks-case-study/" title="neural-networks-case-study" class="md-nav__link">
      neural-networks-case-study
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-optimization-1/" title="optimization-1" class="md-nav__link">
      optimization-1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-optimization-2/" title="optimization-2" class="md-nav__link">
      optimization-2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-overview/" title="Overview of Computer Vision and Visual Recognition overview" class="md-nav__link">
      Overview of Computer Vision and Visual Recognition overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-poster/" title="CS231n Poster Session poster-session" class="md-nav__link">
      CS231n Poster Session poster-session
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-python-numpy-tutorial/" title="Python Numpy Tutorial python-numpy-tutorial" class="md-nav__link">
      Python Numpy Tutorial python-numpy-tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-Readme/" title="ch Readme" class="md-nav__link">
      ch Readme
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-transfer-learning/" title="transfer-learning" class="md-nav__link">
      transfer-learning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/ch-understanding-cnn/" title="understanding-cnn" class="md-nav__link">
      understanding-cnn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-ch/terminal-tutorial/" title="Terminal.com Tutorial terminal-tutorial" class="md-nav__link">
      Terminal.com Tutorial terminal-tutorial
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4-2" type="checkbox" id="nav-4-4-2">
    
    <label class="md-nav__link" for="nav-4-4-2">
      cs231n-en
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-4-2">
        cs231n-en
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-assignment2_google_cloud/" title="Google Cloud Tutorial Part 2 (with GPUs)" class="md-nav__link">
      Google Cloud Tutorial Part 2 (with GPUs)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-aws-tutorial/" title="aws-tutorial" class="md-nav__link">
      aws-tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-classification/" title="classification" class="md-nav__link">
      classification
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-convnet-tips/" title="convnet-tips" class="md-nav__link">
      convnet-tips
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-convolutional-networks/" title="convolutional-networks" class="md-nav__link">
      convolutional-networks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-google_cloud_tutorial/" title="Google Cloud Tutorial" class="md-nav__link">
      Google Cloud Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-ipython-tutorial/" title="IPython Tutorial ipython-tutorial" class="md-nav__link">
      IPython Tutorial ipython-tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-linear-classify/" title="linear-classify" class="md-nav__link">
      linear-classify
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-neural-networks-1/" title="neural-networks-1" class="md-nav__link">
      neural-networks-1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-neural-networks-2/" title="neural-networks-2" class="md-nav__link">
      neural-networks-2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-neural-networks-3/" title="neural-networks-3" class="md-nav__link">
      neural-networks-3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-neural-networks-case-study/" title="neural-networks-case-study" class="md-nav__link">
      neural-networks-case-study
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-optimization-1/" title="optimization-1" class="md-nav__link">
      optimization-1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-optimization-2/" title="optimization-2" class="md-nav__link">
      optimization-2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-overview/" title="Overview of Computer Vision and Visual Recognition overview" class="md-nav__link">
      Overview of Computer Vision and Visual Recognition overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-poster/" title="CS231n Poster Session poster-session" class="md-nav__link">
      CS231n Poster Session poster-session
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-python-numpy-tutorial/" title="Python Numpy Tutorial python-numpy-tutorial" class="md-nav__link">
      Python Numpy Tutorial python-numpy-tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-Readme/" title="en Readme" class="md-nav__link">
      en Readme
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-terminal-tutorial/" title="Terminal.com Tutorial terminal-tutorial" class="md-nav__link">
      Terminal.com Tutorial terminal-tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-transfer-learning/" title="transfer-learning" class="md-nav__link">
      transfer-learning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cs231n-en/en-understanding-cnn/" title="understanding-cnn" class="md-nav__link">
      understanding-cnn
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4-3" type="checkbox" id="nav-4-4-3" checked>
    
    <label class="md-nav__link" for="nav-4-4-3">
      example
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-4-3">
        example
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../a-web-crawer-with-a-asyncio-coroutines-1/" title="A web crawer with a asyncio coroutines 1" class="md-nav__link">
      A web crawer with a asyncio coroutines 1
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        A web crawer with a asyncio coroutines 2
      </label>
    
    <a href="./" title="A web crawer with a asyncio coroutines 2" class="md-nav__link md-nav__link--active">
      A web crawer with a asyncio coroutines 2
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#coroutines" title="Coroutines" class="md-nav__link">
    Coroutines
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how_python_generators_work" title="How Python Generators Work" class="md-nav__link">
    How Python Generators Work
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building_coroutines_with_generators" title="Building Coroutines With Generators" class="md-nav__link">
    Building Coroutines With Generators
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coordinating_coroutines" title="Coordinating Coroutines" class="md-nav__link">
    Coordinating Coroutines
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bias-variance/" title="Bias variance" class="md-nav__link">
      Bias variance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bitcoin-explained-1/" title="Bitcoin explained 1" class="md-nav__link">
      Bitcoin explained 1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dive-into-gradient-decent/" title="Dive into gradient decent" class="md-nav__link">
      Dive into gradient decent
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ethereum-ultimate-guide/" title="Ethereum ultimate guide" class="md-nav__link">
      Ethereum ultimate guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fork-exec-source/" title="Fork exec source" class="md-nav__link">
      Fork exec source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../latex语法/" title="Latex语法" class="md-nav__link">
      Latex语法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../latex语法1/" title="Latex语法1" class="md-nav__link">
      Latex语法1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../nosql-in-python/" title="Nosql in python" class="md-nav__link">
      Nosql in python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../perceptron/" title="Perceptron" class="md-nav__link">
      Perceptron
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../quick-latex/" title="Quick latex" class="md-nav__link">
      Quick latex
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tendermint/" title="Tendermint" class="md-nav__link">
      Tendermint
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4-4" type="checkbox" id="nav-4-4-4">
    
    <label class="md-nav__link" for="nav-4-4-4">
      example2
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-4-4">
        example2
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/arrays-similar/" title="Arrays similar" class="md-nav__link">
      Arrays similar
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/baidu-ife-1/" title="Baidu ife 1" class="md-nav__link">
      Baidu ife 1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/create-my-blog-with-jekyll/" title="Create my blog with jekyll" class="md-nav__link">
      Create my blog with jekyll
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/front-end-tools/" title="Front end tools" class="md-nav__link">
      Front end tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/git-clone-not-master-branch/" title="Git clone not master branch" class="md-nav__link">
      Git clone not master branch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/History-API/" title="History API" class="md-nav__link">
      History API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/how-to-use-babel/" title="How to use babel" class="md-nav__link">
      How to use babel
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/how-to-write-a-count-down/" title="How to write a count down" class="md-nav__link">
      How to write a count down
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/JavaScript-closure/" title="JavaScript closure" class="md-nav__link">
      JavaScript closure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/JavaScript-function/" title="JavaScript function" class="md-nav__link">
      JavaScript function
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/JavaScript-good-parts-note1/" title="JavaScript good parts note1" class="md-nav__link">
      JavaScript good parts note1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/JavaScript-good-parts-note2/" title="JavaScript good parts note2" class="md-nav__link">
      JavaScript good parts note2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/JavaScript-good-parts-note3/" title="JavaScript good parts note3" class="md-nav__link">
      JavaScript good parts note3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/JavaScript-Net/" title="JavaScript Net" class="md-nav__link">
      JavaScript Net
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/JavaScript-Object-Oriented/" title="JavaScript Object Oriented" class="md-nav__link">
      JavaScript Object Oriented
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/JavaScript-this/" title="JavaScript this" class="md-nav__link">
      JavaScript this
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/jekyll-theme-version-2.0/" title="Jekyll theme version 2.0" class="md-nav__link">
      Jekyll theme version 2.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/js-create-file-and-download/" title="Js create file and download" class="md-nav__link">
      Js create file and download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/low-IE-click-empty-block-bug/" title="low IE click empty block bug" class="md-nav__link">
      low IE click empty block bug
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/regular-expression-group/" title="Regular expression group" class="md-nav__link">
      Regular expression group
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/scope/" title="Scope" class="md-nav__link">
      Scope
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/shuffle-algorithm/" title="Shuffle algorithm" class="md-nav__link">
      Shuffle algorithm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/sublimeLinter/" title="sublimeLinter" class="md-nav__link">
      sublimeLinter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/Syncing-a-fork/" title="Syncing a fork" class="md-nav__link">
      Syncing a fork
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/teach-girlfriend-html-css/" title="Teach girlfriend html css" class="md-nav__link">
      Teach girlfriend html css
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/web-app/" title="Web app" class="md-nav__link">
      Web app
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../example2/weinre/" title="Weinre" class="md-nav__link">
      Weinre
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      工具
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        工具
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../工具/About/" title="About" class="md-nav__link">
      About
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../工具/Cheatsheet/" title="Cheatsheet" class="md-nav__link">
      Cheatsheet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../工具/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../工具/shell显示时间/" title="Shell显示时间" class="md-nav__link">
      Shell显示时间
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-5" type="checkbox" id="nav-5-5">
    
    <label class="md-nav__link" for="nav-5-5">
      常用工具
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-5">
        常用工具
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../工具/常用工具/10分钟上手Latex/" title="10分钟上手Latex" class="md-nav__link">
      10分钟上手Latex
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../工具/常用工具/10分钟上手Pandas/" title="10分钟上手Pandas" class="md-nav__link">
      10分钟上手Pandas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../工具/常用工具/10分钟上手Python/" title="10分钟上手Python" class="md-nav__link">
      10分钟上手Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      文章
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        文章
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../文章/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      日常
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        日常
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../日常/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      test
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        test
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../日常/test/testtest/" title="Testtest" class="md-nav__link">
      Testtest
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#coroutines" title="Coroutines" class="md-nav__link">
    Coroutines
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how_python_generators_work" title="How Python Generators Work" class="md-nav__link">
    How Python Generators Work
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building_coroutines_with_generators" title="Building Coroutines With Generators" class="md-nav__link">
    Building Coroutines With Generators
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coordinating_coroutines" title="Coordinating Coroutines" class="md-nav__link">
    Coordinating Coroutines
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>A web crawer with a asyncio coroutines 2</h1>
                
                <hr />
<p>本文译自： <a href="http://www.aosabook.org/en/500L/a-web-crawler-with-asyncio-coroutines.html">A Web Crawler With asyncio Coroutines</a>。</p>
<p>在上一篇的最后, 我们提到了多线程与异步的一些问题, 下面来介绍一下 Python 的协程(coroutines), 它兼具了多线程与异步的一些优点.</p>
<h3 id="coroutines">Coroutines<a class="headerlink" href="#coroutines" title="Permanent link">&para;</a></h3>
<p>其实是存在 “美貌与智慧” 兼得的方法的。 将回调的有效性与多线程程序的经典好处结合到一起的异步代码是很有可能的。其方法就是使用叫做 “协程(coroutines)” 的模式。使用 Python3.4 中的标准 asyncio 库，和一个叫做 "aiohttp" 的 package, 在一个协程中获取一个 URL 非常直观：</p>
<div class="codehilite"><pre><span></span><span class="nd">@asyncio.coroutines</span>
<span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>

<p>它同时还具有伸缩性 (scalable)。 与每个线程 50k 的内存消耗与操作系统对于线程的严格限制相比，一个 Python 的协程仅仅消耗 3k . Python 可以轻松地启动成百上千的协程。</p>
<p>协程的概念其实很简单: 它是一个能够被暂停和重新启动的子程序。尽管线程被操作系统抢占式的多任务安排，协程的多任务是协作式的：它们选择合适暂停，然后下一次运行哪一个协程。</p>
<p>协程有许多实现，即使是在 Python 中也有好几个实现。在 Python3.4 的标准 "asyncio" 库中， 协程基于生成器，使用了 "yield from" 声明. 自从 Python 3.5 , 线程已经成为语言的一个天然特性。不过，理解在 Python  3.4 中首先实现的协程，使用预先存在的语言功能，是利用 Python 3.5 天然协程的基础。</p>
<p>为了解释 Python 3.4 中基于生成器的协程，我们将会阐述生成器是什么以及在 asyncio 它们是如何用作协程。相信你跟我们乐于书写这部分一样乐于阅读. 一旦解释完基于生成器的协程，我们将会在我们的异步网络爬虫中使用它们。</p>
<h3 id="how_python_generators_work">How Python Generators Work<a class="headerlink" href="#how_python_generators_work" title="Permanent link">&para;</a></h3>
<p>在理解 Python 的生成器之前，你必须要理解普通的 Python 函数是如何工作的。 通常来说，当一个Python 函数调用一个 subroutine 时，这个 subroutine 会保留控制直到返回或是抛出一个异常。然后控制返回给调用者：</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
<span class="o">...</span>     <span class="n">bar</span><span class="p">()</span>
<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
<span class="o">...</span>     <span class="k">pass</span>
</pre></div>

<p>标准的 Python 解释器使用 C 写的。执行一个 Python 函数的 C 函数叫做 <code>PyEval_EvalFrameEx</code>. 它需要一个 Python stack frame 对象，在 frame 的上下文中对 Python 字节码进行求值。 这里是 <code>foo</code> 的字节码:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">dis</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
  <span class="mi">2</span>           <span class="mi">0</span> <span class="n">LOAD_GLOBAL</span>              <span class="mi">0</span> <span class="p">(</span><span class="n">bar</span><span class="p">)</span>
              <span class="mi">3</span> <span class="n">CALL_FUNCTION</span>            <span class="mi">0</span> <span class="p">(</span><span class="mi">0</span> <span class="n">positional</span><span class="p">,</span> <span class="mi">0</span> <span class="n">keyword</span> <span class="n">pair</span><span class="p">)</span>
              <span class="mi">6</span> <span class="n">POP_TOP</span>
              <span class="mi">7</span> <span class="n">LOAD_CONST</span>               <span class="mi">0</span> <span class="p">(</span><span class="bp">None</span><span class="p">)</span>
             <span class="mi">10</span> <span class="n">RETURN_VALUE</span>
</pre></div>

<p><code>foo</code> 函数将 <code>bar</code> 加载到栈上然后进行调用，并将其从栈上弹出返回值，将 <code>None</code> 入栈，返回 <code>None</code>.</p>
<p>当 <code>PyEval_EvalFrameEx</code> 遇到 <code>CALL_FUNCTION</code> 字节码，它会调用一个新的 Python stack frame 然后递归: 也就是说，它在新的 frame 下递归地调用 <code>PyEval_EvalFrameEx</code> , 以此来执行 <code>bar</code>.</p>
<p>非常重要的一点是要知道 Python stack frame 是分配于堆内存上！ Python 解释器是一个普通的 C 程序而已，所以它的的 stack  frame 也是正常的 stack frame. 但是它控制的 <em>Python stack</em> frame 在堆上。除了其他惊喜，这还意味着一个 Python stack frame 能够比它的函数调用存活时间更长。 为了交互式地观察这一点，在 <code>bar</code> 内部保存当前的 frame:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">inspect</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">frame</span> <span class="o">=</span> <span class="bp">None</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
<span class="o">...</span>     <span class="n">bar</span><span class="p">()</span>
<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
<span class="o">...</span>     <span class="k">global</span> <span class="n">frame</span>
<span class="o">...</span>     <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span>
<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># The frame was executing the code for &#39;bar&#39;.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
<span class="s1">&#39;bar&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Its back pointer refers to the frame for &#39;foo&#39;.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">caller_frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_back</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">caller_frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
<span class="s1">&#39;foo&#39;</span>
</pre></div>

<p>![function-calls]({{ site.baseurl }}{{ site.images }}/posts/function-calls.png)</p>
<p>现在开始设置 Python 生成器的阶段，它使用了同样的 building  block - code objects and stack frames - 效果非凡。</p>
<p>这是一个生成器函数:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">gen_fn</span><span class="p">():</span>
<span class="o">...</span>     <span class="n">result</span> <span class="o">=</span> <span class="k">yield</span> <span class="mi">1</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="s1">&#39;result of yield: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
<span class="o">...</span>     <span class="n">result2</span> <span class="o">=</span> <span class="k">yield</span> <span class="mi">2</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="s1">&#39;result of 2nd yield: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result2</span><span class="p">))</span>
<span class="o">...</span>     <span class="k">return</span> <span class="s1">&#39;done&#39;</span>
<span class="o">...</span>
</pre></div>

<p>当Python把 <code>gen_fn</code> 编译为字节码，它会看到 <code>yield</code> 并且知道 <code>gen_fn</code> 是一个生成器函数，而不是普通函数。那么他就会设置一个标记:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="c1"># The generator flag is bit position 5.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">generator_bit</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">bool</span><span class="p">(</span><span class="n">gen_fn</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_flags</span> <span class="o">&amp;</span> <span class="n">generator_bit</span><span class="p">)</span>
<span class="bp">True</span>
</pre></div>

<p>当你调用一个生成器函数时， Python 看到生成器标志，它并不会真正的运行这个函数，而是创建一个生成器：</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">gen</span> <span class="o">=</span> <span class="n">gen_fn</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">generator</span><span class="s1">&#39;&gt;</span>
</pre></div>

<p>一个 Python 生成器封装了一个 stack  frame 和对某些代码的引用， <code>gen_fn</code> 的主体:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">gen</span><span class="o">.</span><span class="n">gi_code</span><span class="o">.</span><span class="n">co_name</span>
<span class="s1">&#39;gen_fn&#39;</span>
</pre></div>

<p>对 <code>gen_fn</code> 的调用的所有生成器都指向同样的代码。但是每一个都拥有自己的 stack frame. 这个 stack frame 并不是任何真正的栈，它位于堆内存并且等待被使用:</p>
<p>![function-calls]({{ site.baseurl }}{{ site.images }}/posts/generator.png)</p>
<p>frame 有一个 "最近指令 (last instruction)" 指针，它最近执行最多的指令。开始的时候，最近指令指针为 -1， 表示生成器还没有开始：</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">gen</span><span class="o">.</span><span class="n">gi_frame</span><span class="o">.</span><span class="n">f_lasti</span>
<span class="o">-</span><span class="mi">1</span>
</pre></div>

<p>当我们调用 <code>send</code> , 生成器到底它的第一个 <code>yield</code>, 然后暂停。<code>send</code> 的返回值为 1， 因此这就是 <code>gen</code> 传递给 <code>yield</code> 表达式的值：</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">gen</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="mi">1</span>
</pre></div>

<p>生成器的指令指针现在距离开始 3 个字节码， 编译后的Python 56 个字节:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">gen</span><span class="o">.</span><span class="n">gi_frame</span><span class="o">.</span><span class="n">f_lasti</span>
<span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">gen</span><span class="o">.</span><span class="n">gi_code</span><span class="o">.</span><span class="n">co_code</span><span class="p">)</span>
<span class="mi">56</span>
</pre></div>

<p>生成器可以在任何时间，从任何函数中重新开始，因为它的 stack frame 实际上并没有在栈上: 它在堆上。它在调用继承上的位置并不是固定的，它也不需要像普通函数那样遵循先进后出的执行顺序。 它是自由的，没有任何限制。</p>
<p>我们可以发送 "hello" 给生成器，那么 "hello" 会成为 <code>yield</code> 表达式的结果， 生成器会一直持续直到它产生 2:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">gen</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="n">result</span> <span class="n">of</span> <span class="k">yield</span><span class="p">:</span> <span class="n">hello</span>
<span class="mi">2</span>
</pre></div>

<p>它的 stack frame 现在包含了本地变量 <code>result</code>:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">gen</span><span class="o">.</span><span class="n">gi_frame</span><span class="o">.</span><span class="n">f_locals</span>
<span class="p">{</span><span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;hello&#39;</span><span class="p">}</span>
</pre></div>

<p>由 <code>gen_fn</code> 创建的其他生成器将会拥有它们自己独立的 stack  frame 和 本地变量。</p>
<p>当我们再次调用 <code>send</code> 时，生成器将会从第二个 <code>yield</code> 继续，并且最终抛出一个特殊的 <code>StopIteration</code> 异常:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">gen</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;goodbye&#39;</span><span class="p">)</span>
<span class="n">result</span> <span class="n">of</span> <span class="mi">2</span><span class="n">nd</span> <span class="k">yield</span><span class="p">:</span> <span class="n">goodbye</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;input&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">StopIteration</span><span class="p">:</span> <span class="n">done</span>
</pre></div>

<p>这个异常有一个值，这个值就是生成器的返回值: 字符串 <code>&quot;done&quot;</code> .</p>
<h3 id="building_coroutines_with_generators">Building Coroutines With Generators<a class="headerlink" href="#building_coroutines_with_generators" title="Permanent link">&para;</a></h3>
<p>所以一个生成器可以暂停, 通过一个值来重新启动，并且有一个返回值。听起来像是可以基于此来构建一个异步程序模型的一个不错的原型，而不必烦人的回调！ 我们想要构建一个 "协程": 一个能够与程序中其他协程合作调度的协程。我们的协程将是一个 Python 标准库 "asyncio" 的相应内容的简化版本。在 asyncio 中，我们将会使用生成器，futures, 和 "yield from" 语句。</p>
<p>首先我们需要有一个方式来表示一个协程等待的未知的结果。 简化版本:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Future</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">add_done_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">:</span>
            <span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>

<p>一个 future 初始为 "pending". 通过一个队 <code>set_result</code> <sup id="fnref:9"><a class="footnote-ref" href="#fn:9" rel="footnote">9</a></sup> 的调用来 "解决" 。</p>
<p>让我们调整 fetcher 来使用 future 和 协程。 写一个带有回调的 <code>fetch</code>:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Fetcher</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">setblocking</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s1">&#39;xkcd.com&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">BlockingIOError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">selector</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span>
                          <span class="n">EVENT_WRITE</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;connected!&#39;</span><span class="p">)</span>
        <span class="c1"># And so on....</span>
</pre></div>

<p><code>fetch</code> 以连接一个 socket 开始，然后注册回调， <code>connected</code>, 当 socket 准备好以后执行。 现在我们尅将这两步组合到一个协程中:</p>
<div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">setblocking</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s1">&#39;xkcd.com&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">BlockingIOError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">Future</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">on_connected</span><span class="p">():</span>
            <span class="n">f</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

        <span class="n">selector</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span>
                          <span class="n">EVENT_WRITE</span><span class="p">,</span>
                          <span class="n">on_connected</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">f</span>
        <span class="n">selector</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="p">())</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;connected!&#39;</span><span class="p">)</span>
</pre></div>

<p>现在的 <code>fetch</code> 是一个生成器函数，而非一个普通函数，因为它包含了一个 <code>yield</code> 语句。 我们创建一个挂起的 future, 然后生成它来暂停 <code>fetch</code> 直到 socket 准备好。 内部函数 <code>on_connected</code> 解析 future.</p>
<p>当时当 future 解析的时候，什么来重新启动生成器？我们需要一个协程 "驱动器 (driver)". 就叫它 "task" 吧.</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Task</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coro</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coro</span> <span class="o">=</span> <span class="n">coro</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">Future</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">future</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">next_future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coro</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">next_future</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>

<span class="c1"># Begin fetching http://xkcd.com/353/</span>
<span class="n">fetcher</span> <span class="o">=</span> <span class="n">Fetcher</span><span class="p">(</span><span class="s1">&#39;/353/&#39;</span><span class="p">)</span>
<span class="n">Task</span><span class="p">(</span><span class="n">fetcher</span><span class="o">.</span><span class="n">fetch</span><span class="p">())</span>

<span class="n">loop</span><span class="p">()</span>
</pre></div>

<p>通过发送 <code>None</code> 给 task 来启动 <code>fetch</code> 生成器。 然后 <code>fetch</code> 运行直至它生成一个 future, 同时会被 task 捕获为 <code>next_future</code> .</p>
<h3 id="coordinating_coroutines">Coordinating Coroutines<a class="headerlink" href="#coordinating_coroutines" title="Permanent link">&para;</a></h3>
<p>一旦 socket 连接上，我们就发送 HTTP GET 请求并读取服务器的响应。 这些步骤不再需要分散于回调之间; 我们可以将它们组合到同一个生成器函数中:</p>
<div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ... connection logic from above, then:</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">Future</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">on_readable</span><span class="p">():</span>
                <span class="n">f</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">))</span>

            <span class="n">selector</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span>
                              <span class="n">EVENT_READ</span><span class="p">,</span>
                              <span class="n">on_readable</span><span class="p">)</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">f</span>
            <span class="n">selector</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">+=</span> <span class="n">chunk</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Done reading.</span>
                <span class="k">break</span>
</pre></div>

<p>这段代码，读了 socket 的全部消息，似乎通常都很有用。 我们如何才能将它从 <code>fetch</code> 分离并填充到一个协程中?  现在 Python 3 的 <code>yield from</code> 能够完成这个任务。它允许一个生成器委托另一个生成器.</p>
<p>为了理解为何如此，让我们回到一个简单的生成器示例：</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">gen_fn</span><span class="p">():</span>
<span class="o">...</span>     <span class="n">result</span> <span class="o">=</span> <span class="k">yield</span> <span class="mi">1</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="s1">&#39;result of yield: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
<span class="o">...</span>     <span class="n">result2</span> <span class="o">=</span> <span class="k">yield</span> <span class="mi">2</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="s1">&#39;result of 2nd yield: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result2</span><span class="p">))</span>
<span class="o">...</span>     <span class="k">return</span> <span class="s1">&#39;done&#39;</span>
<span class="o">...</span>
</pre></div>

<p>从另一个的生成器中调用这个生成器，使用 <code>yield from</code> 委托给它:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="c1"># Generator function:</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">caller_fn</span><span class="p">():</span>
<span class="o">...</span>     <span class="n">gen</span> <span class="o">=</span> <span class="n">gen_fn</span><span class="p">()</span>
<span class="o">...</span>     <span class="n">rv</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">gen</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="s1">&#39;return value of yield-from: {}&#39;</span>
<span class="o">...</span>           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rv</span><span class="p">))</span>
<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Make a generator from the</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># generator function.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">caller</span> <span class="o">=</span> <span class="n">caller_fn</span><span class="p">()</span>
</pre></div>

<p><code>caller</code> 生成器表现地就如同 <code>gen</code>,它所委托的生成器:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">caller</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">caller</span><span class="o">.</span><span class="n">gi_frame</span><span class="o">.</span><span class="n">f_lasti</span>
<span class="mi">15</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">caller</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="n">result</span> <span class="n">of</span> <span class="k">yield</span><span class="p">:</span> <span class="n">hello</span>
<span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">caller</span><span class="o">.</span><span class="n">gi_frame</span><span class="o">.</span><span class="n">f_lasti</span>  <span class="c1"># Hasn&#39;t advanced.</span>
<span class="mi">15</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">caller</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;goodbye&#39;</span><span class="p">)</span>
<span class="n">result</span> <span class="n">of</span> <span class="mi">2</span><span class="n">nd</span> <span class="k">yield</span><span class="p">:</span> <span class="n">goodbye</span>
<span class="k">return</span> <span class="n">value</span> <span class="n">of</span> <span class="k">yield</span><span class="o">-</span><span class="n">from</span><span class="p">:</span> <span class="n">done</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;input&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">StopIteration</span>
</pre></div>

<p>当 <code>caller</code> 生成自 <code>gen</code>, <code>caller</code> 并不优先。 注意到它的指令指针停留在 15，<code>yield from</code> 语句的地方，即使是当内部的生成器 <code>gen</code> 先于一个 <code>yield</code> 语句进行到下一个 <sup id="fnref:10"><a class="footnote-ref" href="#fn:10" rel="footnote">10</a></sup>。 从我们的视角来看 <code>caller</code>, 我们无法区分它所产生的值是来自 <code>caller</code> 还是它所代表的生成器。 从内部的 <code>gen</code>, 我们无法区分值是发送自 <code>caller</code> 还是 <code>caller</code> 外部。 <code>yield from</code> 语句是一个无摩擦的通道，尽管这些值会流入流出 <code>gen</code> 直到 <code>gen</code> 完成。</p>
<p>一个协程可以通过 <code>yield from</code> 将工作委托给一个子协程并接受任务结果。 注意，上面的 <code>caller</code> 打印出 "return value of yield-from: done" . 当 <code>gen</code> 完成后， 它的返回值变成了 <code>caller</code> 里面的 <code>yield from</code> 语句的返回值:</p>
<div class="codehilite"><pre><span></span>    <span class="n">rv</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">gen</span>
</pre></div>

<p>早先，我们批评了基于回调的异步程序的不足之处，最大的一个缺点是 "stack ripping": 当一个回调抛出异常时，追踪栈通常并没有什么用。 它只是显示出事件循环正在运行回调，却没有指示 <em>为什么</em> 。 那么协程如何呢?</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">gen_fn</span><span class="p">():</span>
<span class="o">...</span>     <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;my error&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">caller</span> <span class="o">=</span> <span class="n">caller_fn</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">caller</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;input&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;input&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">3</span><span class="p">,</span> <span class="ow">in</span> <span class="n">caller_fn</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;input&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2</span><span class="p">,</span> <span class="ow">in</span> <span class="n">gen_fn</span>
<span class="ne">Exception</span><span class="p">:</span> <span class="n">my</span> <span class="n">error</span>
</pre></div>

<p>这些信息相当有用！追踪栈显示 <code>caller_fn</code> 委托了 <code>gen_fn</code> 当它抛出错误的时候。 更有效的是，我们可以将子协程的调用包装在一个异常的 handler 猴子那个，同样适用于正常的子协程:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">gen_fn</span><span class="p">():</span>
<span class="o">...</span>     <span class="k">yield</span> <span class="mi">1</span>
<span class="o">...</span>     <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;uh oh&#39;</span><span class="p">)</span>
<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">caller_fn</span><span class="p">():</span>
<span class="o">...</span>     <span class="k">try</span><span class="p">:</span>
<span class="o">...</span>         <span class="k">yield from</span> <span class="n">gen_fn</span><span class="p">()</span>
<span class="o">...</span>     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<span class="o">...</span>         <span class="k">print</span><span class="p">(</span><span class="s1">&#39;caught {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">caller</span> <span class="o">=</span> <span class="n">caller_fn</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">caller</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">caller</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="n">caught</span> <span class="n">uh</span> <span class="n">oh</span>
</pre></div>

<p>所以我们使用子协程来分离逻辑就像使用普通的子协程一样。 让我们从 fetcher 中分离一些有用的子协程。 我们写一个 <code>read</code> 协程来接收一个数据块:</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">sock</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">Future</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_readable</span><span class="p">():</span>
        <span class="n">f</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">))</span>

    <span class="n">selector</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="n">EVENT_READ</span><span class="p">,</span> <span class="n">on_readable</span><span class="p">)</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">f</span>  <span class="c1"># Read one chunk.</span>
    <span class="n">selector</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">fileno</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">chunk</span>
</pre></div>

<p>基于 <code>read</code> 我们使用了 <code>read_all</code> 协程来获取一个完整的消息:</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read_all</span><span class="p">(</span><span class="n">sock</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Read whole response.</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">read</span><span class="p">(</span><span class="n">sock</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">chunk</span><span class="p">:</span>
        <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">read</span><span class="p">(</span><span class="n">sock</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>

<p>如果你仔细看的话，<code>yield from</code> 语句不见了，它们看起来就像是执行阻塞时 I/O 的传统程序。 但是实际上，<code>read</code> 和 <code>read_all</code> 都是协程。 <code>read</code> 所产生的内容会暂停 <code>read_all</code> 直到 I/O 完成. 当 <code>read_all</code> 暂停后，asyncio 的事件循环会做其他事情和等到其他的 I/O 事件; 一旦它的事件准备好了，<code>read_all</code> 就会以下一个循环 tick 的 <code>read</code> 的结果重新开始。</p>
<p>在栈底, <code>fetch</code> 调用 <code>read_all</code>:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Fetcher</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="c1"># ... connection logic from above, then:</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">read_all</span><span class="p">(</span><span class="n">sock</span><span class="p">)</span>
</pre></div>

<p>出乎意料地，Task 类并不需要有所改变。它会像之前一样驱动外部的 <code>fetch</code> 协程:</p>
<div class="codehilite"><pre><span></span><span class="n">Task</span><span class="p">(</span><span class="n">fetcher</span><span class="o">.</span><span class="n">fetch</span><span class="p">())</span>
<span class="n">loop</span><span class="p">()</span>
</pre></div>

<p>当 <code>read</code> 生成一个 future, task 通过 <code>yield from</code> 语句的通道接收 future, 更准确地说，就想好事 future 直接产生自 <code>fetch</code>. 当循环解析一个 future, task 将它的结果发送给 <code>fetch</code>, 并且值被 <code>read</code> 所接收, 跟 task 直接驱动 <code>read</code> 一样:</p>
<p>![yield-from]({{ site.baseurl }}{{ site.images }}/posts/yield-from.png)</p>
<p>为了完善我们的协程实现， 我们去除一个缺点： 当等待一个 future 时使用 <code>yield</code>, 但是当它委托给一个子协程时使用 <code>yield from</code>. 如果无论当一个协程何时暂停，我们都使用 <code>yield from</code> 就更好了。那么一个协程就不再需要考虑它所等待的是一个什么类型的东西.</p>
<p>我们利用了 Python 中生成器与迭代器之间的深层次联系。 对 caller 来说，生成器很高级， 迭代器同样很高级。所以我们通过实现一个特殊的方法来使得 Future 类可迭代:</p>
<div class="codehilite"><pre><span></span>    <span class="c1"># Method on Future class.</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Tell Task to resume me here.</span>
        <span class="k">yield</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span>
</pre></div>

<p>future 的 <code>__iter__</code> 方法是一个产生 future 自身的协程。 现在我们来替换像这样的代码:</p>
<div class="codehilite"><pre><span></span><span class="c1"># f is a Future.</span>
<span class="k">yield</span> <span class="n">f</span>
</pre></div>

<p>用这样的来替换:</p>
<div class="codehilite"><pre><span></span><span class="c1"># f is a Future.</span>
<span class="k">yield from</span> <span class="n">f</span>
</pre></div>

<p>...结果是一样的！ 驱动 Task 从它对 <code>send</code> 的调用中接收 future, 当 future 被解析后它将新的结果返回给协程。</p>
<p>到处使用 <code>yield from</code> 有什么好处呢? 为什么使用 <code>yield</code> 等待 future 和使用 <code>yield from</code> 委托给子协程更好？ 它更好是因为，一个方法可以不影响 caller 而自由地改变它的实现: 它可能是一个普通的方法，返回将会 <em>解析</em> 为一个值的 future , 或者它可能是一个包含了 <code>yield from</code> 语句的协程，并且 <em>返回</em> 了一个值。 无论是哪种情况，caller 仅需要从方法中 <code>yeild from</code> 以此来等待结果。</p>
<p>至此，我们到了 asyncio 中协程的尾部。 我们仔细了解了生成器的工作机制，大概勾勒了 future 和 task 的实现。 当然了，实际的 asyncio  要比我们勾勒的版本要复杂得多。真正的框架解决了 另附纸 I/O, 公平安排，异常捕获和一些其他丰富的特性。</p>
<p>对于 asyncio 的用户而言， 使用协程来写程序要比上面看到的要简单得多。 在上面的代码中，我们从第一个原则起实现了一个协程，里面包括了 callback, task 和 future. 你甚至看到了非阻塞式的 socket 和对于 <code>select</code> 的调用。 但是当使用 asyncio 来真正构建一个应用时， 上面的代码并不会出现。如我们所望，你可以像下面一样简洁地获取一个 URL:</p>
<div class="codehilite"><pre><span></span>    <span class="nd">@asyncio.coroutine</span>
    <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>

<p>对于协程的阐述到此告一段落，下面回到一开始的任务: 使用 asyncio 写一个异步爬虫.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Guido introduced the standard asyncio library, called "Tulip" then, at <a href="http://pyvideo.org/video/1667/keynote">PyCon 2013</a>.&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>Even calls to send can block, if the recipient is slow to acknowledge outstanding messages and the system's buffer of outgoing data is full.&#160;<a class="footnote-backref" href="#fnref:2" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p><a href="http://www.kegel.com/c10k.html">http://www.kegel.com/c10k.html</a>&#160;<a class="footnote-backref" href="#fnref:3" rev="footnote" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:4">
<p>Python's global interpreter lock prohibits running Python code in parallel in one process anyway. Parallelizing CPU-bound algorithms in Python requires multiple processes, or writing the parallel portions of the code in C. But that is a topic for another day.&#160;<a class="footnote-backref" href="#fnref:4" rev="footnote" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:5">
<p>Jesse listed indications and contraindications for using async in "What Is Async, How Does It Work, And When Should I Use It?":. Mike Bayer compared the throughput of asyncio and multithreading for different workloads in "Asynchronous Python and Databases":&#160;<a class="footnote-backref" href="#fnref:5" rev="footnote" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn:6">
<p>For a complex solution to this problem, see <a href="http://www.tornadoweb.org/en/stable/stack_context.html">http://www.tornadoweb.org/en/stable/stack_context.html</a>&#160;<a class="footnote-backref" href="#fnref:6" rev="footnote" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
<li id="fn:7">
<p>The @asyncio.coroutine decorator is not magical. In fact, if it decorates a generator function and the PYTHONASYNCIODEBUG environment variable is not set, the decorator does practically nothing. It just sets an attribute, _is_coroutine, for the convenience of other parts of the framework. It is possible to use asyncio with bare generators not decorated with @asyncio.coroutine at all.&#160;<a class="footnote-backref" href="#fnref:7" rev="footnote" title="Jump back to footnote 7 in the text">&#8617;</a></p>
</li>
<li id="fn:8">
<p>Python 3.5's built-in coroutines are described in PEP 492, "Coroutines with async and await syntax."&#160;<a class="footnote-backref" href="#fnref:8" rev="footnote" title="Jump back to footnote 8 in the text">&#8617;</a></p>
</li>
<li id="fn:9">
<p>This future has many deficiencies. For example, once this future is resolved, a coroutine that yields it should resume immediately instead of pausing, but with our code it does not. See asyncio's Future class for a complete implementation.↩&#160;<a class="footnote-backref" href="#fnref:9" rev="footnote" title="Jump back to footnote 9 in the text">&#8617;</a></p>
</li>
<li id="fn:10">
<p>In fact, this is exactly how "yield from" works in CPython. A function increments its instruction pointer before executing each statement. But after the outer generator executes "yield from", it subtracts 1 from its instruction pointer to keep itself pinned at the "yield from" statement. Then it yields to its caller. The cycle repeats until the inner generator throws StopIteration, at which point the outer generator finally allows itself to advance to the next instruction.↩&#160;<a class="footnote-backref" href="#fnref:10" rev="footnote" title="Jump back to footnote 10 in the text">&#8617;</a></p>
</li>
<li id="fn:11">
<p><a href="https://docs.python.org/3/library/queue.html">https://docs.python.org/3/library/queue.html</a>&#160;<a class="footnote-backref" href="#fnref:11" rev="footnote" title="Jump back to footnote 11 in the text">&#8617;</a></p>
</li>
<li id="fn:12">
<p><a href="https://docs.python.org/3/library/asyncio-sync.html">https://docs.python.org/3/library/asyncio-sync.html</a>&#160;<a class="footnote-backref" href="#fnref:12" rev="footnote" title="Jump back to footnote 12 in the text">&#8617;</a></p>
</li>
<li id="fn:13">
<p>The actual asyncio.Queue implementation uses an asyncio.Event in place of the Future shown here. The difference is an Event can be reset, whereas a Future cannot transition from resolved back to pending.&#160;<a class="footnote-backref" href="#fnref:13" rev="footnote" title="Jump back to footnote 13 in the text">&#8617;</a></p>
</li>
<li id="fn:14">
<p><a href="https://glyph.twistedmatrix.com/2014/02/unyielding.html">https://glyph.twistedmatrix.com/2014/02/unyielding.html</a>&#160;<a class="footnote-backref" href="#fnref:14" rev="footnote" title="Jump back to footnote 14 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../a-web-crawer-with-a-asyncio-coroutines-1/" title="A web crawer with a asyncio coroutines 1" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                A web crawer with a asyncio coroutines 1
              </span>
            </div>
          </a>
        
        
          <a href="../bias-variance/" title="Bias variance" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Bias variance
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2016 - 2018 Martin Donath
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="http://struct.cc" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/1007530194" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/1007530194" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/1007530194" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.8eb9be28.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:"../../../.."}})</script>
      
        <script src="../../../../javascripts/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
    
  </body>
</html>
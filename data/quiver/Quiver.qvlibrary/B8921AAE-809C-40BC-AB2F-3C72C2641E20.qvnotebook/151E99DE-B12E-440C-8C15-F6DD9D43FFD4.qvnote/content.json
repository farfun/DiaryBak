{"title":"2018-02-21-ch-aws-tutorial","cells":[{"type":"markdown","data":"---\ncategories: posts/cs231n-ch\nmath: y\nlayout: page\ntitle: AWS Tutorial\ntitle: aws-tutorial\n---\nFor GPU instances, we also have an Amazon Machine Image (AMI) that you can use\nto launch GPU instances on Amazon EC2. This tutorial goes through how to set up\nyour own EC2 instance with the provided AMI. **We do not currently \ndistribute AWS credits to CS231N students but you are welcome to use this \nsnapshot on your own budget.**\n\n**TL;DR** for the AWS-savvy: Our image is\n`cs231n_caffe_torch7_keras_lasagne_v2`, AMI ID: `ami-125b2c72` in the us-west-1\nregion. Use a `g2.2xlarge` instance.  Caffe, Torch7, Theano, Keras and Lasagne\nare pre-installed. Python bindings of caffe are available. It has CUDA 7.5 and\nCuDNN v3.\n\nFirst, if you don't have an AWS account already, create one by going to the [AWS\nhomepage](http://aws.amazon.com/), and clicking on the yellow \"Sign In to the\nConsole\" button. It will direct you to a signup page which looks like the\nfollowing.\n\n<div class='fig figcenter fighighlight'>\n  <img src='/Diary/assets/images/cs231n/aws-signup.png'>\n</div>\n\nSelect the \"I am a new user\" checkbox, click the \"Sign in using our secure\nserver\" button, and follow the subsequent pages to provide the required details.\nThey will ask for a credit card information, and also a phone verification, so\nhave your phone and credit card ready.\n\nOnce you have signed up, go back to the [AWS homepage](http://aws.amazon.com),\nclick on \"Sign In to the Console\", and this time sign in using your username and\npassword.\n\n<div class='fig figcenter fighighlight'>\n  <img src='/Diary/assets/images/cs231n/aws-signin.png'>\n</div>\n\nOnce you have signed in, you will be greeted by a page like this:\n\n<div class='fig figcenter fighighlight'>\n  <img src='/Diary/assets/images/cs231n/aws-homepage.png'>\n</div>\n\nMake sure that the region information on the top right is set to N. California.\nIf it is not, change it to N. California by selecting from the dropdown menu\nthere.\n\n(Note that the subsequent steps requires your account to be \"Verified\" by\n Amazon. This may take up to 2 hrs, and you may not be able to launch instances\n until your account verification is complete.)\n\nNext, click on the EC2 link (first link under the Compute category). You will go\nto a dashboard page like this:\n\n<div class='fig figcenter fighighlight'>\n  <img src='/Diary/assets/images/cs231n/ec2-dashboard.png'>\n</div>\n\nClick the blue \"Launch Instance\" button, and you will be redirected to a page\nlike the following:\n\n<div class='fig figcenter fighighlight'>\n  <img src='/Diary/assets/images/cs231n/ami-selection.png'>\n</div>\n\nClick on the \"Community AMIs\" link on the left sidebar, and search for \"cs231n\"\nin the search box. You should be able to see the AMI\n`cs231n_caffe_torch7_keras_lasagne_v2` (AMI ID: `ami-125b2c72`). Select that\nAMI, and continue to the next step to choose your instance type.\n\n<div class='fig figcenter fighighlight'>\n  <img src='/Diary/assets/images/cs231n/community-AMIs.png'>\n</div>\n\nChoose the instance type `g2.2xlarge`, and click on \"Review and Launch\".\n\n<div class='fig figcenter fighighlight'>\n  <img src='/Diary/assets/images/cs231n/instance-selection.png'>\n</div>\n\nIn the next page, click on Launch.\n\n<div class='fig figcenter fighighlight'>\n  <img src='/Diary/assets/images/cs231n/launch-screen.png'>\n</div>\n\nYou will be then prompted to create or use an existing key-pair. If you already\nuse AWS and have a key-pair, you can use that, or alternately you can create a\nnew one by choosing \"Create a new key pair\" from the drop-down menu and giving\nit some name of your choice. You should then download the key pair, and keep it\nsomewhere that you won't accidentally delete. Remember that there is **NO WAY**\nto get to your instance if you lose your key. \n\n<div class='fig figcenter fighighlight'>\n  <img src='/Diary/assets/images/cs231n/key-pair.png'>\n</div>\n\n<div class='fig figcenter fighighlight'>\n  <img src='/Diary/assets/images/cs231n/key-pair-create.png'>\n</div>\n\nOnce you download your key, you should change the permissions of the key to\nuser-only RW, In Linux/OSX you can do it by:\n"},{"type":"code","language":"text","data":"$ chmod 600 PEM_FILENAME"},{"type":"markdown","data":"Here `PEM_FILENAME` is the full file name of the .pem file you just downloaded.\n\nAfter this is done, click on \"Launch Instances\", and you should see a screen\nshowing that your instances are launching:\n\n<div class='fig figcenter fighighlight'>\n  <img src='/Diary/assets/images/cs231n/launching-screen.png'>\n</div>\n\nClick on \"View Instances\" to see your instance state. It should change to\n\"Running\" and \"2/2 status checks passed\" as shown below within some time. You\nare now ready to ssh into the instance.\n\n<div class='fig figcenter fighighlight'>\n  <img src='/Diary/assets/images/cs231n/instances-page.png'>\n</div>\n\nFirst, note down the Public IP of the instance from the instance listing. Then,\ndo:\n"},{"type":"code","language":"text","data":"ssh -i PEM_FILENAME ubuntu@PUBLIC_IP"},{"type":"markdown","data":"\nNow you should be logged in to the instance. You can check that Caffe is working\nby doing:\n"},{"type":"code","language":"text","data":"$ cd caffe\n$ ./build/tools/caffe time --gpu 0 --model examples/mnist/lenet.prototxt"},{"type":"markdown","data":"\nWe have Caffe, Theano, Torch7, Keras and Lasagne pre-installed. Caffe python\nbindings are also available by default. We have CUDA 7.5 and CuDNN v3 installed.\n\nIf you encounter any error such as \n"},{"type":"code","language":"text","data":"Check failed: error == cudaSuccess (77 vs.  0)  an illegal memory access was encountered"},{"type":"markdown","data":"\nyou might want to terminate your instance and start over again. I have observed\nthis rarely, and I am not sure what causes this.\n\nAbout how to use these instances:\n\n- The root directory is only 12GB, and only ~ 3GB of that is free.\n- There should be a 60GB `/mnt` directory that you can use to put your data,\nmodel checkpoints, models etc.\n- Remember that the `/mnt` directory won't be persistent across\nreboots/terminations.\n- Stop your instances when are done for the day to avoid incurring charges. GPU\ninstances are costly. Use your funds wisely. Terminate them when you are sure\nyou are done with your instance (disk storage also costs something, and can be\nsignificant if you have a large disk footprint).\n- Look into creating custom alarms to automatically stop your instances when\nthey are not doing anything.\n- If you need access to a large dataset and don't want to download it every time\nyou spin up an instance, the best way to go would be to create an AMI for that\nand attach that AMI to your machine when configuring your instance (before\nlaunching but after you have selected the AMI).\n"}]}